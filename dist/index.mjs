function f(a,r,e){let t=new Uint8Array(a.memory.buffer,r,e);return new TextDecoder("utf-8").decode(t)}var l=class extends Error{constructor(r){super("Error over FFI"),this.error_value=r}};function h(a,r){return new Uint32Array(a.memory.buffer,r,1)[0]}function d(a,r,e){return new Uint8Array(a.memory.buffer,r+e,1)[0]}function c(a,r){return new Int32Array(a.memory.buffer,r,1)[0]}var u=class a{static str8=(r,e)=>{var t=0;for(let n of e){let w=n.codePointAt(0);w<128?t+=1:w<2048?t+=2:w<65536?t+=3:t+=4}let i=r.diplomat_alloc(t,1),s=new TextEncoder().encodeInto(e,new Uint8Array(r.memory.buffer,i,t));return console.assert(e.length==s.read&&t==s.written,"UTF-8 write error"),new a(i,t,()=>r.diplomat_free(i,t,1))};static str16=(r,e)=>{let t=e.length*2,i=r.diplomat_alloc(t,2),s=new Uint16Array(r.memory.buffer,i,e.length);for(var n=0;n<e.length;n++)s[n]=e.charCodeAt(n);return new a(i,e.length,()=>r.diplomat_free(i,t,2))};static slice=(r,e,t)=>{let i=t=="u8"||t=="i8"||t=="bool"?1:t=="u16"||t=="i16"?2:t=="u64"||t=="i64"||t=="f64"?8:4,s=e.length*i,n=r.diplomat_alloc(s,i);return(t=="u8"||t=="bool"?new Uint8Array(r.memory.buffer,n,s):t=="i8"?new Int8Array(r.memory.buffer,n,s):t=="u16"?new Uint16Array(r.memory.buffer,n,s):t=="i16"?new Int16Array(r.memory.buffer,n,s):t=="i32"||t=="isize"?new Int32Array(r.memory.buffer,n,s):t=="u64"?new BigUint64Array(r.memory.buffer,n,s):t=="i64"?new BigInt64Array(r.memory.buffer,n,s):t=="f32"?new Float32Array(r.memory.buffer,n,s):t=="f64"?new Float64Array(r.memory.buffer,n,s):new Uint32Array(r.memory.buffer,n,s)).set(e),new a(n,e.length,()=>r.diplomat_free(n,s,i))};constructor(r,e,t){this.ptr=r,this.size=e,this.free=t,this.leak=()=>{},this.garbageCollect=()=>R.register(this,this.free)}},R=new FinalizationRegistry(a=>a());var _={wasm_path:new URL("wasm/icu_capi.wasm",import.meta.url)};var m,C={env:{diplomat_console_debug_js(a,r){console.debug(f(m,a,r))},diplomat_console_error_js(a,r){console.error(f(m,a,r))},diplomat_console_info_js(a,r){console.info(f(m,a,r))},diplomat_console_log_js(a,r){console.log(f(m,a,r))},diplomat_console_warn_js(a,r){console.warn(f(m,a,r))},diplomat_throw_error_js(a,r){throw new Error(f(m,a,r))}}};if(globalThis.process?.getBuiltinModule){let a=globalThis.process.getBuiltinModule("fs"),r=new Uint8Array(a.readFileSync(_.wasm_path));m=(await WebAssembly.instantiate(r,C)).instance.exports}else if(globalThis.process){let a=await import("fs"),r=new Uint8Array(a.readFileSync(_.wasm_path));m=(await WebAssembly.instantiate(r,C)).instance.exports}else m=(await WebAssembly.instantiateStreaming(fetch(_.wasm_path),C)).instance.exports;m.diplomat_init();_.init!==void 0&&_.init(m);var o=m;var p={0:"UnknownError",256:"DataMissingDataMarkerError",257:"DataMissingVariantError",258:"DataMissingLocaleError",259:"DataNeedsVariantError",260:"DataNeedsLocaleError",261:"DataExtraneousLocaleError",262:"DataFilteredResourceError",263:"DataMismatchedTypeError",264:"DataMissingPayloadError",265:"DataInvalidStateError",266:"DataCustomError",267:"DataIoError",268:"DataUnavailableBufferFormatError",269:"DataMismatchedAnyBufferError",513:"LocaleParserLanguageError",514:"LocaleParserSubtagError",515:"LocaleParserExtensionError",768:"DataStructValidityError",1026:"PropertyUnexpectedPropertyNameError",1280:"FixedDecimalLimitError",1281:"FixedDecimalSyntaxError",1536:"PluralsParseError",1795:"CalendarOutOfRangeError",1796:"CalendarUnknownEraError",1797:"CalendarUnknownMonthCodeError",2048:"DateTimePatternError",2049:"DateTimeMissingInputFieldError",2050:"DateTimeSkeletonError",2051:"DateTimeUnsupportedFieldError",2052:"DateTimeUnsupportedOptionsError",2053:"DateTimeMissingWeekdaySymbolError",2054:"DateTimeMissingMonthSymbolError",2055:"DateTimeFixedDecimalError",2056:"DateTimeMismatchedCalendarError",2561:"TimeZoneInvalidOffsetError",2563:"TimeZoneInvalidIdError"};var v=new FinalizationRegistry(a=>{o.ICU4XDataProvider_destroy(a)}),E=class a{#r=[];constructor(r,e,t){this.underlying=r,this.#r.push(...t),e&&v.register(this,r)}static create_compiled(){return new a(o.ICU4XDataProvider_create_compiled(),!0,[])}static create_fs(r){let e=u.str8(o,r),t=(()=>{let i=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_create_fs(i,e.ptr,e.size),d(o,i,4)){let n=new a(h(o,i),!0,[]);return o.diplomat_free(i,5,4),n}else{let n=p[c(o,i)];throw o.diplomat_free(i,5,4),new l(n)}})();return e.free(),t}static create_from_byte_slice(r){let e=u.slice(o,r,"u8"),t=(()=>{let i=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_create_from_byte_slice(i,e.ptr,e.size),d(o,i,4)){let n=new a(h(o,i),!0,[]);return o.diplomat_free(i,5,4),n}else{let n=p[c(o,i)];throw o.diplomat_free(i,5,4),new l(n)}})();return e.leak(),t}static create_empty(){return new a(o.ICU4XDataProvider_create_empty(),!0,[])}fork_by_key(r){return(()=>{let e=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_fork_by_key(e,this.underlying,r.underlying),d(o,e,4)){let i={};return o.diplomat_free(e,5,4),i}else{let i=p[c(o,e)];throw o.diplomat_free(e,5,4),new l(i)}})()}fork_by_locale(r){return(()=>{let e=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_fork_by_locale(e,this.underlying,r.underlying),d(o,e,4)){let i={};return o.diplomat_free(e,5,4),i}else{let i=p[c(o,e)];throw o.diplomat_free(e,5,4),new l(i)}})()}enable_locale_fallback(){return(()=>{let r=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_enable_locale_fallback(r,this.underlying),d(o,r,4)){let t={};return o.diplomat_free(r,5,4),t}else{let t=p[c(o,r)];throw o.diplomat_free(r,5,4),new l(t)}})()}enable_locale_fallback_with(r){return(()=>{let e=o.diplomat_alloc(5,4);if(o.ICU4XDataProvider_enable_locale_fallback_with(e,this.underlying,r.underlying),d(o,e,4)){let i={};return o.diplomat_free(e,5,4),i}else{let i=p[c(o,e)];throw o.diplomat_free(e,5,4),new l(i)}})()}};var M=new FinalizationRegistry(a=>{o.ICU4XGraphemeClusterBreakIteratorLatin1_destroy(a)}),D=class{#r=[];constructor(r,e,t){this.underlying=r,this.#r.push(...t),e&&M.register(this,r)}next(){return o.ICU4XGraphemeClusterBreakIteratorLatin1_next(this.underlying)}};var P=new FinalizationRegistry(a=>{o.ICU4XGraphemeClusterBreakIteratorUtf16_destroy(a)}),y=class{#r=[];constructor(r,e,t){this.underlying=r,this.#r.push(...t),e&&P.register(this,r)}next(){return o.ICU4XGraphemeClusterBreakIteratorUtf16_next(this.underlying)}};var S=new FinalizationRegistry(a=>{o.ICU4XGraphemeClusterBreakIteratorUtf8_destroy(a)}),b=class{#r=[];constructor(r,e,t){this.underlying=r,this.#r.push(...t),e&&S.register(this,r)}next(){return o.ICU4XGraphemeClusterBreakIteratorUtf8_next(this.underlying)}};var L=new FinalizationRegistry(a=>{o.ICU4XGraphemeClusterSegmenter_destroy(a)}),g=class a{#r=[];constructor(r,e,t){this.underlying=r,this.#r.push(...t),e&&L.register(this,r)}static create(r){return(()=>{let e=o.diplomat_alloc(5,4);if(o.ICU4XGraphemeClusterSegmenter_create(e,r.underlying),d(o,e,4)){let i=new a(h(o,e),!0,[]);return o.diplomat_free(e,5,4),i}else{let i=p[c(o,e)];throw o.diplomat_free(e,5,4),new l(i)}})()}segment_utf8(r){let e=u.str8(o,r),t=new b(o.ICU4XGraphemeClusterSegmenter_segment_utf8(this.underlying,e.ptr,e.size),!0,[this,e]);return e.garbageCollect(),t}segment_utf16(r){let e=u.str16(o,r),t=new y(o.ICU4XGraphemeClusterSegmenter_segment_utf16(this.underlying,e.ptr,e.size),!0,[this,e]);return e.garbageCollect(),t}segment_latin1(r){let e=u.slice(o,r,"u8"),t=new D(o.ICU4XGraphemeClusterSegmenter_segment_latin1(this.underlying,e.ptr,e.size),!0,[this,e]);return e.garbageCollect(),t}};var pr=new FinalizationRegistry(a=>{o.ICU4XLogger_destroy(a)});function X(a,r,e,t){let i=a[r];if(i===void 0)return t;if(i=String(i),e.indexOf(i)===-1)throw new RangeError(`Invalid string option: ${r}=${i}`);return i}var k=class{constructor(r,e){let t=X(e,"granularity",["grapheme","word","sentence"],"grapheme");if(t==="grapheme")this.inner=g.create(E.create_compiled());else throw new RangeError(`Granularity not yet supported: ${t}`)}segment(r){return r=String(r),new I(this,r)}},I=class{constructor(r,e){this.segmenter=r,this.string=e}[Symbol.iterator](){return new x(this.segmenter,this.string)}};function F(a,r){return{value:a,done:r}}function T(a,r,e,t){return{segment:r.substr(e,t),index:e,input:r}}var x=class{constructor(r,e){this.segmenter=r,this.breakIterator=r.inner.segment_utf16(e),this.startIndex=this.breakIterator.next(),this.string=e}next(){if(this.startIndex>=this.string.length)return F(void 0,!0);let r=this.breakIterator.next(),e=T(this.segmenter,this.string,this.startIndex,r);return this.startIndex=r,F(e,!1)}};export{E as ICU4XDataProvider,g as ICU4XGraphemeClusterSegmenter,x as IntlSegmenterIteratorImplICU4X,k as SegmenterImplICU4X,I as SegmentsImplICU4X};
//# sourceMappingURL=index.mjs.map
